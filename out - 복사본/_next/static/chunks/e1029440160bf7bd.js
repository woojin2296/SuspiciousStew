(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,99749,68626,e=>{"use strict";function t(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}e.s(["_",()=>t],99749),e.s(["AudioManager",()=>i],68626);class i{static getInstance(e){return i.instance||(i.instance=new i(e)),i.instance}playBGM(e){this.currentBGMKey&&this.currentBGMKey===e||(this.game.sound.play(e,{loop:!0,volume:this.muted?0:this.masterVolume*this.bgmVolume}),this.currentBGMKey=e)}playSFX(e){this.game.sound.play(e,{volume:this.muted?0:this.masterVolume*this.sfxVolume})}setMasterVolume(e){this.masterVolume=e,this.updateVolumes()}setBGMVolume(e){this.bgmVolume=e,this.updateVolumes()}setSFXVolume(e){this.sfxVolume=e}setMuted(e){this.muted=e,this.updateVolumes()}getMasterVolume(){return this.masterVolume}getBGMVolume(){return this.bgmVolume}getSFXVolume(){return this.sfxVolume}isMuted(){return this.muted}updateVolumes(){let e=this.game.sound.get(this.currentBGMKey||"");if(e){let t=this.muted?0:this.masterVolume*this.bgmVolume;"function"==typeof e.setVolume?e.setVolume(t):e.volume=t}}constructor(e){t(this,"game",void 0),t(this,"currentBGMKey",null),t(this,"masterVolume",1),t(this,"bgmVolume",1),t(this,"sfxVolume",1),t(this,"muted",!1),this.game=e}}t(i,"instance",null)},10211,e=>{"use strict";e.s(["Player",()=>r]);var t=e.i(99749),i=e.i(33901),s=e.i(68626);class r{static load(e){e.load.spritesheet(this.TEXTURE_KEY,this.TEXTURE_PATH,{frameWidth:this.TILE_WIDTH,frameHeight:this.TILE_HEIGHT})}static registerAnims(e){let t=(t,i)=>!e.anims.exists(t)&&e.anims.create({key:t,...i});t(this.ANIM_IDLE.key,{frames:e.anims.generateFrameNumbers(this.TEXTURE_KEY,{start:this.ANIM_IDLE.start,end:this.ANIM_IDLE.end}),frameRate:this.ANIM_IDLE.frameRate,repeat:this.ANIM_IDLE.repeat}),t(this.ANIM_ATTACK.key,{frames:e.anims.generateFrameNumbers(this.TEXTURE_KEY,{start:this.ANIM_ATTACK.start,end:this.ANIM_ATTACK.end}),frameRate:this.ANIM_ATTACK.frameRate,repeat:this.ANIM_ATTACK.repeat}),t(this.ANIM_DAMAGE.key,{frames:e.anims.generateFrameNumbers(this.TEXTURE_KEY,{start:this.ANIM_DAMAGE.start,end:this.ANIM_DAMAGE.end}),frameRate:this.ANIM_DAMAGE.frameRate,repeat:this.ANIM_DAMAGE.repeat})}async moveTo(e){return new Promise(t=>{s.AudioManager.getInstance(this.scene.game).playSFX("walk"),this.scene.tweens.add({targets:this.entity,x:r.TILE_SIZE*e.col,y:r.TILE_SIZE*e.row,duration:200,ease:"Sine.easeInOut",onComplete:()=>{t()}})})}attack(){this.entity.play(r.ANIM_ATTACK.key).once(i.Animations.Events.ANIMATION_COMPLETE,()=>{this.entity.play(r.ANIM_IDLE.key)})}async damage(){return s.AudioManager.getInstance(this.scene.game).playSFX("hit"),new Promise(e=>{this.entity.play(r.ANIM_DAMAGE.key).once(i.Animations.Events.ANIMATION_COMPLETE,()=>{this.entity.play(r.ANIM_IDLE.key),e()})})}constructor(e,i){(0,t._)(this,"scene",void 0),(0,t._)(this,"entity",void 0),this.scene=e,this.entity=e.add.sprite(r.TILE_SIZE*i.col,r.TILE_SIZE*i.row,r.TEXTURE_KEY).play(r.ANIM_IDLE.key).setOrigin(0,.5).setDepth(1e4)}}(0,t._)(r,"TEXTURE_PATH","/texture/Player.png"),(0,t._)(r,"TEXTURE_KEY","texture.Player"),(0,t._)(r,"TILE_WIDTH",16),(0,t._)(r,"TILE_HEIGHT",32),(0,t._)(r,"ANIM_IDLE",{key:"player.anim.idle",start:0,end:1,frameRate:3,repeat:-1}),(0,t._)(r,"ANIM_ATTACK",{key:"player.anim.attack",start:3,end:6,frameRate:12,repeat:0}),(0,t._)(r,"ANIM_DAMAGE",{key:"player.anim.damage",start:8,end:11,frameRate:12,repeat:0}),(0,t._)(r,"TILE_SIZE",16)},52483,e=>{"use strict";e.s(["Door",()=>i]);var t=e.i(99749);class i{static load(e){e.load.spritesheet(this.TEXTURE_KEY,this.TEXTURE_PATH,{frameWidth:this.TILE_WIDTH,frameHeight:this.TILE_HEIGHT})}static registerAnims(e){}async moveTo(e){return new Promise(t=>{this.scene.tweens.add({targets:this.entity,x:16*e.col,y:16*e.row,duration:200,ease:"Sine.easeInOut",onComplete:()=>{t()}})})}open(){this.entity.setFrame(1)}close(){this.entity.setFrame(0)}constructor(e,s,r=!1){(0,t._)(this,"scene",void 0),(0,t._)(this,"entity",void 0),this.scene=e,this.entity=e.add.sprite(16*s.col,16*s.row,i.TEXTURE_KEY,0).setOrigin(0,0).setDepth(5e3),r&&this.open()}}(0,t._)(i,"TEXTURE_PATH","/texture/Door.png"),(0,t._)(i,"TEXTURE_KEY","texture.Door"),(0,t._)(i,"TILE_WIDTH",16),(0,t._)(i,"TILE_HEIGHT",16)},9021,e=>{"use strict";e.s(["Box",()=>s]);var t=e.i(99749),i=e.i(68626);class s{static load(e){e.load.spritesheet(this.TEXTURE_KEY,this.TEXTURE_PATH,{frameWidth:this.TILE_WIDTH,frameHeight:this.TILE_HEIGHT})}static registerAnims(e){}async moveTo(e){return new Promise(t=>{this.scene.tweens.add({targets:this.entity,x:16*e.col,y:16*e.row,duration:200,ease:"Sine.easeInOut",onComplete:()=>{t()}})})}restore(){this.entity.setFrame(0)}destroy(){i.AudioManager.getInstance(this.scene.game).playSFX("destroy"),this.entity.setFrame(1)}constructor(e,i){(0,t._)(this,"scene",void 0),(0,t._)(this,"entity",void 0),this.scene=e,this.entity=e.add.sprite(16*i.col,16*i.row,s.TEXTURE_KEY,0).setOrigin(0,0).setDepth(5e3)}}(0,t._)(s,"TEXTURE_PATH","/texture/Box.png"),(0,t._)(s,"TEXTURE_KEY","texture.Box"),(0,t._)(s,"TILE_WIDTH",16),(0,t._)(s,"TILE_HEIGHT",16)},10707,e=>{"use strict";e.s(["Key",()=>s]);var t=e.i(99749),i=e.i(68626);class s{static load(e){e.load.spritesheet(this.TEXTURE_KEY,this.TEXTURE_PATH,{frameWidth:this.TILE_WIDTH,frameHeight:this.TILE_HEIGHT})}static registerAnims(e){}async moveTo(e){return new Promise(t=>{this.scene.tweens.add({targets:this.entity,x:16*e.col,y:16*e.row,duration:200,ease:"Sine.easeInOut",onComplete:()=>{t()}})})}restore(){this.entity.setFrame(0)}taken(){this.entity.setFrame(1),i.AudioManager.getInstance(this.scene.game).playSFX("door")}constructor(e,i){(0,t._)(this,"scene",void 0),(0,t._)(this,"entity",void 0),this.scene=e,this.entity=e.add.sprite(16*i.col,16*i.row,s.TEXTURE_KEY,0).setOrigin(0,0).setDepth(5e3)}}(0,t._)(s,"TEXTURE_PATH","/texture/Key.png"),(0,t._)(s,"TEXTURE_KEY","texture.Key"),(0,t._)(s,"TILE_WIDTH",16),(0,t._)(s,"TILE_HEIGHT",16)},86401,e=>{"use strict";e.s(["Slime",()=>i]);var t=e.i(99749);class i{static load(e){e.load.spritesheet(i.TEXTURE_KEY,i.TEXTURE_PATH,{frameWidth:16,frameHeight:16})}static registerAnims(e){let t,i;t=this.ANIM_IDLE.key,i={frames:e.anims.generateFrameNumbers(this.TEXTURE_KEY,{start:this.ANIM_IDLE.start,end:this.ANIM_IDLE.end}),frameRate:this.ANIM_IDLE.frameRate,repeat:this.ANIM_IDLE.repeat},e.anims.exists(t)||e.anims.create({key:t,...i})}async moveTo(e,t){var i,s;return"left"===t?null==(i=this.entity)||i.play("slime.move.left"):"right"===t&&(null==(s=this.entity)||s.play("slime.move.right")),new Promise(i=>{this.scene.tweens.add({targets:this.entity,x:16*e.col,y:16*e.row,duration:200,ease:"Sine.easeInOut",onComplete:()=>{var e;("left"===t||"right"===t)&&(null==(e=this.entity)||e.play("slime.idle")),i()}})})}constructor(e,s){(0,t._)(this,"scene",void 0),(0,t._)(this,"entity",void 0),this.scene=e,this.entity=this.scene.add.sprite(16*s.col,16*s.row,i.TEXTURE_KEY).play(i.ANIM_IDLE.key).setOrigin(0,0).setDepth(5e3)}}(0,t._)(i,"TEXTURE_PATH","/texture/Slime.png"),(0,t._)(i,"TEXTURE_KEY","texture.Slime"),(0,t._)(i,"ANIM_IDLE",{key:"slime.anim.idle",start:0,end:1,frameRate:3,repeat:-1})},3757,e=>{"use strict";e.s(["BaseStage",()=>l]);var t=e.i(99749),i=e.i(33901),s=e.i(10211),r=e.i(52483),o=e.i(9021),a=e.i(10707),n=e.i(86401);class l extends i.Scene{getAvailablePatches(){return[]}getMaxSelectablePatches(){return 1}getPresence(){return{key:!0,box:!0,slime1:!0,slime2:!0}}precomputeSlimeNextTargets(e){let t=this.entitys.slime1,i=this.entitys.slime2,s=e=>({dc:"left"===e?-1:+("right"===e),dr:"up"===e?-1:+("down"===e)}),r=t=>{if(!t||t.disabled)return[-9999,-9999];let i=t.dir,{dc:r,dr:o}=s(i),a=t.pos.col+r,n=t.pos.row+o;return e(a,n)&&(i="left"===i?"right":"right"===i?"left":"up"===i?"down":"up",{dc:r,dr:o}=s(i),a=t.pos.col+r,n=t.pos.row+o),[a,n]},o=r(t),a=r(i);return[o[0],o[1],a[0],a[1]]}onPreTags(e,t,i,s,r,o){}moveSlimeWithBounce(e,t){var i;if(!e||e.disabled)return;let s=t=>({nsx:e.pos.col+("left"===t?-1:+("right"===t)),nsy:e.pos.row+("up"===t?-1:+("down"===t))}),{nsx:r,nsy:o}=s(e.dir);t(r,o)&&(e.dir="left"===e.dir?"right":"right"===e.dir?"left":"up"===e.dir?"down":"up",{nsx:r,nsy:o}=s(e.dir)),null==(i=e.obj)||i.moveTo({col:r,row:o},e.dir),e.pos={col:r,row:o}}onAfterProceed(e){}computeNextPlayerTarget(e){return null}canCollideWithSlime(){return!0}shouldConsumeMove(){return!0}preload(){this.load.tilemapTiledJSON(this.getMapKey(),"/map/".concat(this.getMapKey().replace("map.",""),".json"))}create(){var e,t,i,l,h;this.cameras.main.setBackgroundColor("#0b0b53");let m=this.make.tilemap({key:this.getMapKey()}),c=m.addTilesetImage("TileSet","texture.TileSet");if(!c)return;for(let{name:e,depth:t}of[{name:"floor",depth:0},{name:"void",depth:1},{name:"pillardown",depth:2},{name:"pillarup",depth:10001},{name:"wall",depth:4}]){let i=m.createLayer(e,c,0,0);i&&(i.setDepth(t),this.layers[e]=i)}this.patchLocked=!1,this.patches=[],this.isMoving=!1,this.repeatFlag=!1,this.forcedDir=null,this.pendingSlimeHitDir=null,this.gameSetting=this.getPositions();let d=this.getInitialSlimeDirs(),u=this.getPresence();this.entitys={player:{obj:new s.Player(this,{col:this.gameSetting.SPAWN_POS.col,row:this.gameSetting.SPAWN_POS.row}),disabled:!1,pos:{col:this.gameSetting.SPAWN_POS.col,row:this.gameSetting.SPAWN_POS.row}},door:{obj:new r.Door(this,{col:this.gameSetting.GOAL_POS.col,row:this.gameSetting.GOAL_POS.row},this.gameSetting.HAS_KEY),disabled:!1,pos:{col:this.gameSetting.GOAL_POS.col,row:this.gameSetting.GOAL_POS.row}},slime1:u.slime1?{obj:new n.Slime(this,{col:this.gameSetting.SLIME1_POS.col,row:this.gameSetting.SLIME1_POS.row}),disabled:!1,dir:d.slime1,pos:{col:this.gameSetting.SLIME1_POS.col,row:this.gameSetting.SLIME1_POS.row}}:void 0,slime2:u.slime2?{obj:new n.Slime(this,{col:this.gameSetting.SLIME2_POS.col,row:this.gameSetting.SLIME2_POS.row}),disabled:!1,dir:d.slime2,pos:{col:this.gameSetting.SLIME2_POS.col,row:this.gameSetting.SLIME2_POS.row}}:void 0,box:u.box?{obj:new o.Box(this,{col:this.gameSetting.BOX_POS.col,row:this.gameSetting.BOX_POS.row}),disabled:!1,pos:{col:this.gameSetting.BOX_POS.col,row:this.gameSetting.BOX_POS.row}}:void 0,key:u.key?{obj:new a.Key(this,{col:this.gameSetting.KEY_POS.col,row:this.gameSetting.KEY_POS.row}),disabled:!1,pos:{col:this.gameSetting.KEY_POS.col,row:this.gameSetting.KEY_POS.row}}:void 0},this.isMoving=!1;let p=this.scene.get("game").eventBus,g=this.scene.get("game").gameEventBus;p.emit("ui:moves",this.gameSetting.MOVE_LIMIT);let y=this.getAvailablePatches();p.emit("patch:availability",y.length>0&&!this.patchLocked),p.on("note:open",()=>{this.scene.launch("patchnote-ui",{patches:y,selected:this.patches,locked:this.patchLocked,maxPatches:this.getMaxSelectablePatches()}),this.scene.bringToTop("patchnote-ui")}),this.repeatFlag=!1,null==(e=this.input.keyboard)||e.addCapture(["UP","DOWN","LEFT","RIGHT"]);let E=e=>{this.patches.includes(2)&&(this.repeatFlag=!0);let t=this.patches.includes(5)&&this.forcedDir?this.forcedDir:e;g.emit("game:input",t)};null==(t=this.input.keyboard)||t.on("keydown-UP",()=>E("up")),null==(i=this.input.keyboard)||i.on("keydown-DOWN",()=>E("down")),null==(l=this.input.keyboard)||l.on("keydown-LEFT",()=>E("left")),null==(h=this.input.keyboard)||h.on("keydown-RIGHT",()=>E("right"));let _=(e,t)=>e===this.entitys.door.pos.col&&t===this.entitys.door.pos.row&&this.gameSetting.HAS_KEY,T=(e,t)=>this.entitys.key&&e===this.entitys.key.pos.col&&t===this.entitys.key.pos.row&&!this.entitys.key.disabled,S=(e,t)=>this.searchLayer(e,t).includes("wall")||this.searchLayer(e,t).includes("pillardown"),I=(e,t)=>this.entitys.box&&e===this.entitys.box.pos.col&&t===this.entitys.box.pos.row&&!1===this.entitys.box.disabled,w=(e,t)=>this.searchLayer(e,t).includes("pillarup"),A=(e,t)=>this.searchLayer(e,t).includes("void");g.on("game:input",e=>{if(this.patchLocked=!0,p.emit("patch:availability",!1),this.isMoving)return;this.isMoving=!0;let t=this.computeNextPlayerTarget(e),{dc:i,dr:s}={left:{dc:-1,dr:0},right:{dc:1,dr:0},up:{dc:0,dr:-1},down:{dc:0,dr:1}}[e],r=t?t.nx:this.entitys.player.pos.col+i,o=t?t.ny:this.entitys.player.pos.row+s,[a,n,l,h]=this.precomputeSlimeNextTargets(S);this.onPreTags(r,o,a,n,l,h);let m=(e,t)=>this.entitys.slime1&&!this.entitys.slime1.disabled&&e===a&&t===n||this.entitys.slime2&&!this.entitys.slime2.disabled&&e===l&&t===h,c=[];if(_(r,o)){p.emit("game:clear"),this.isMoving=!1;return}if(S(r,o)){this.patches.includes(5)&&this.forcedDir&&(this.forcedDir=null),this.isMoving=!1;return}if(T(r,o)&&!m(r,o)&&c.push("key"),I(r,o)&&c.push("box"),this.canCollideWithSlime()&&m(r,o)?(c.push("slime"),this.entitys.slime1&&r===a&&o===n?(this.pendingSlimeHitDir=this.entitys.slime1.dir,this.pendingSlimeId="slime1"):this.entitys.slime2&&r===l&&o===h&&(this.pendingSlimeHitDir=this.entitys.slime2.dir,this.pendingSlimeId="slime2")):(this.pendingSlimeHitDir=null,this.pendingSlimeId=null),g.emit("game:proceed",r,o,c,e),this.entitys.slime1&&!this.entitys.slime1.disabled&&this.moveSlimeWithBounce(this.entitys.slime1,S),this.entitys.slime2&&!this.entitys.slime2.disabled&&this.moveSlimeWithBounce(this.entitys.slime2,S),w(r,o)){let e=this.layers.pillarup,t=this.layers.pillardown,i=null==e?void 0:e.getTileAt(r,o);i&&i.setAlpha(.5);let s=null==t?void 0:t.getTileAt(r,o+1);s&&s.setAlpha(.5)}else{let e=this.layers.pillarup,t=this.layers.pillardown;null==e||e.forEachTile(e=>e.setAlpha(1)),null==t||t.forEachTile(e=>e.setAlpha(1))}if(this.shouldConsumeMove()&&(this.gameSetting.MOVE_LIMIT-=1,p.emit("ui:moves",this.gameSetting.MOVE_LIMIT)),this.gameSetting.MOVE_LIMIT<=0)return void p.emit("game:over")}),g.on("game:proceed",async(e,t,i,s)=>{var r,o,a;if(i.includes("key")&&this.entitys.key&&(this.entitys.key.disabled=!0,null==(r=this.entitys.key.obj)||r.taken(),g.emit("game:key:taken")),i.includes("slime"))await this.handlePlayerSlimeCollision(e,t,s,{isWall:S,isBox:I,isVoid:A});else if(i.includes("box")&&this.entitys.box)this.entitys.box.disabled=!0,null==(o=this.entitys.box.obj)||o.destroy();else{let i=this.entitys.player.pos;(e!==i.col||t!==i.row)&&(await (null==(a=this.entitys.player.obj)?void 0:a.moveTo({col:e,row:t})),this.entitys.player.pos={col:e,row:t})}this.isMoving=!1,this.onAfterProceed(s)}),g.on("game:key:taken",()=>{var e;this.gameSetting.HAS_KEY=!0,null==(e=this.entitys.door.obj)||e.open()})}async handlePlayerSlimeCollision(e,t,i,s){var r,o,a,n;let{isWall:l,isBox:h,isVoid:m}=s,c={col:this.entitys.player.pos.col,row:this.entitys.player.pos.row};await (null==(r=this.entitys.player.obj)?void 0:r.moveTo({col:e,row:t})),await (null==(o=this.entitys.player.obj)?void 0:o.damage()),m(c.col,c.row)?(await (null==(a=this.entitys.player.obj)?void 0:a.moveTo({col:c.col,row:c.row})),this.entitys.player.pos={col:c.col,row:c.row},this.scene.get("game").eventBus.emit("game:over")):l(c.col,c.row)||h(c.col,c.row)?this.entitys.player.pos={col:e,row:t}:(await (null==(n=this.entitys.player.obj)?void 0:n.moveTo({col:c.col,row:c.row})),this.entitys.player.pos={col:c.col,row:c.row})}searchLayer(e,t){let i=[];for(let s in this.layers){let r=this.layers[s];if(!r)continue;let o=r.getTileAt(e,t);o&&0!=o.index&&i.push(s)}return i}constructor(...e){super(...e),(0,t._)(this,"layers",{}),(0,t._)(this,"gameSetting",{}),(0,t._)(this,"entitys",{}),(0,t._)(this,"isMoving",!1),(0,t._)(this,"patches",[]),(0,t._)(this,"patchLocked",!1),(0,t._)(this,"repeatFlag",!1),(0,t._)(this,"forcedDir",null),(0,t._)(this,"pendingSlimeHitDir",null),(0,t._)(this,"pendingSlimeId",null)}}},13446,e=>{"use strict";e.s(["Stage4",()=>i]);var t=e.i(3757);class i extends t.BaseStage{getMapKey(){return"map.level4"}getPositions(){return{SPAWN_POS:{col:7,row:9},GOAL_POS:{col:8,row:2},SLIME1_POS:{col:13,row:5},SLIME2_POS:{col:8,row:5},BOX_POS:{col:8,row:9},KEY_POS:{col:8,row:8},HAS_KEY:!1,PLAYER_HP:3,MOVE_LIMIT:9}}getInitialSlimeDirs(){return{slime1:"left",slime2:"left"}}getAvailablePatches(){return[1,2]}getMaxSelectablePatches(){return 1}precomputeSlimeNextTargets(e){let t=this.entitys.slime1,i=this.entitys.slime2,s=e=>({dc:"left"===e?-1:+("right"===e),dr:"up"===e?-1:+("down"===e)}),r=s(t.dir),o=s(i.dir),a=t.pos.col+r.dc,n=t.pos.row+r.dr,l=i.pos.col+o.dc,h=i.pos.row+o.dr;return!this.patches.includes(1)&&(e(a,n)&&(a=t.pos.col,n=t.pos.row),e(l,h)&&(l=i.pos.col,h=i.pos.row)),[a,n,l,h]}moveSlimeWithBounce(e,t){var i;let s=t=>({nsx:e.pos.col+("left"===t?-1:+("right"===t)),nsy:e.pos.row+("up"===t?-1:+("down"===t))}),{nsx:r,nsy:o}=s(e.dir);!this.patches.includes(1)&&t(r,o)&&(e.dir="left"===e.dir?"right":"right"===e.dir?"left":"up"===e.dir?"down":"up",{nsx:r,nsy:o}=s(e.dir),t(r,o)&&(r=e.pos.col,o=e.pos.row)),null==(i=e.obj)||i.moveTo({col:r,row:o},e.dir),e.pos={col:r,row:o}}onAfterProceed(e){this.patches.includes(2)&&this.repeatFlag&&e&&(this.scene.get("game").gameEventBus.emit("game:input",e),this.repeatFlag=!1)}constructor(){super("stage4")}}}]);